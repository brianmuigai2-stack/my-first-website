/* ===========================
   TRANSLATIONS
   =========================== */
   const translations = {
    en: {
      'themes': 'Themes',
      'light': 'Light',
      'dark': 'Dark',
      'ocean': 'Ocean',
      'forest': 'Forest',
      'sunset': 'Sunset',
      'galaxy': 'Galaxy',
      'hero-title': "Hey, I'm Brian ðŸ‘‹",
      'hero-subtitle': 'Building responsive web applications, fullstack systems, and intelligent digital solutions with modern technologies.',
      'view-projects': 'View Projects',
      'contact-me': 'Contact Me',
      'about-title': 'About Me',
      'about-text': "I'm a passionate software engineering student focused on building clean, responsive web applications. I enjoy solving problems with code, contributing to open-source, and continuously learning modern frameworks. Currently exploring React and full-stack development to create impactful digital experiences. I love designing full-stack systems that solve real-world problems â€” from job platforms to real-time collaboration tools and AI-powered applications. My development philosophy centers on writing clean, maintainable code and creating user experiences that make a difference.",
      'projects-label': 'Projects',
      'technologies-label': 'Technologies',
      'commits-label': 'Commits',
      'services-title': 'Services I Offer',
      'service-frontend': 'Front-End Development',
      'service-frontend-desc': 'Creating responsive, interactive web applications using React, Vue.js, and modern JavaScript frameworks.',
      'service-frontend-feature1': 'React/Vue.js Development',
      'service-frontend-feature2': 'Responsive Design',
      'service-frontend-feature3': 'Performance Optimization',
      'service-backend': 'Back-End Development',
      'service-backend-desc': 'Building robust server-side applications with Node.js, Express, and database integration.',
      'service-backend-feature1': 'Node.js/Express APIs',
      'service-backend-feature2': 'Database Design',
      'service-backend-feature3': 'Authentication Systems',
      'service-uiux': 'UI/UX Design',
      'service-uiux-desc': 'Designing beautiful, user-centered interfaces that provide exceptional user experiences.',
      'service-uiux-feature1': 'Wireframing & Prototyping',
      'service-uiux-feature2': 'User Research',
      'service-uiux-feature3': 'Design Systems',
      'get-quote': 'Get Quote â†’',
      'skills-title': 'Skills',
      'projects-title': 'Projects',
      'filter-all': 'All',
      'filter-web': 'Web',
      'filter-mobile': 'Mobile',
      'filter-ui': 'UI',
      'filter-tools': 'Tools',
      'contact-title': 'Get In Touch',
      'email-label': 'Email',
      'phone-label': 'Phone',
      'location-label': 'Location',
      'name-label': 'Your Name',
      'email-input-label': 'Your Email',
      'subject-label': 'Subject',
      'message-label': 'Message',
      'send-message': 'Send Message',
      'blog-title': 'Latest Articles',
      'read-more': 'Read More â†’',
      'testimonials-title': 'What Clients Say',
      'testimonial1': '"Brian delivered an exceptional web application that exceeded our expectations. His attention to detail and problem-solving skills are outstanding. Highly recommended!"',
      'testimonial1-role': 'CEO, TechStart Inc.',
      'testimonial2': '"Working with Brian was a pleasure. He brought our vision to life with clean code and innovative solutions. His communication and professionalism are top-notch."',
      'testimonial2-role': 'Product Manager, InnovateCo',
      'testimonial3': '"Brian\'s expertise in React and modern web technologies helped us launch our product ahead of schedule. His dedication to quality is impressive."',
      'testimonial3-role': 'CTO, StartupHub',
      'newsletter-title': 'Stay Updated',
      'newsletter-subtitle': 'Get the latest updates on my projects and articles delivered to your inbox',
      'subscribe': 'Subscribe',
      'privacy-notice': 'I respect your privacy. Unsubscribe at any time. No spam, ever.',
      'success-message': 'Successfully subscribed! Check your email for confirmation.',
      'resume-title': 'Resume & Achievements',
      'resume-subtitle': 'Get a detailed overview of my experience and skills',
      'view-resume': 'View Resume',
      'privacy': 'Privacy Policy',
      'terms': 'Terms of Service'
    },
    es: {
      'themes': 'Temas',
      'light': 'Claro',
      'dark': 'Oscuro',
      'ocean': 'OcÃ©ano',
      'forest': 'Bosque',
      'sunset': 'Atardecer',
      'galaxy': 'Galaxia',
      'hero-title': 'Hola, soy Brian ðŸ‘‹',
      'hero-subtitle': 'Desarrollador Junior | Entusiasta de React | Solucionador de Problemas',
      'view-projects': 'Ver Proyectos',
      'contact-me': 'ContÃ¡ctame',
      'about-title': 'Acerca de MÃ­',
      'about-text': 'Soy un estudiante apasionado de ingenierÃ­a de software enfocado en construir aplicaciones web limpias y responsivas. Disfruto resolviendo problemas con cÃ³digo, contribuyendo a cÃ³digo abierto y aprendiendo continuamente frameworks modernos. Actualmente explorando React y desarrollo full-stack para crear experiencias digitales impactantes.',
      'projects-label': 'Proyectos',
      'technologies-label': 'TecnologÃ­as',
      'commits-label': 'Commits',
      'services-title': 'Servicios que Ofrezco',
      'service-frontend': 'Desarrollo Front-End',
      'service-frontend-desc': 'Creando aplicaciones web responsivas e interactivas usando React, Vue.js y frameworks modernos de JavaScript.',
      'service-frontend-feature1': 'Desarrollo React/Vue.js',
      'service-frontend-feature2': 'DiseÃ±o Responsivo',
      'service-frontend-feature3': 'OptimizaciÃ³n de Rendimiento',
      'service-backend': 'Desarrollo Back-End',
      'service-backend-desc': 'Construyendo aplicaciones robustas del lado del servidor con Node.js, Express e integraciÃ³n de bases de datos.',
      'service-backend-feature1': 'APIs Node.js/Express',
      'service-backend-feature2': 'DiseÃ±o de Base de Datos',
      'service-backend-feature3': 'Sistemas de AutenticaciÃ³n',
      'service-uiux': 'DiseÃ±o UI/UX',
      'service-uiux-desc': 'DiseÃ±ando interfaces hermosas y centradas en el usuario que proporcionen experiencias de usuario excepcionales.',
      'service-uiux-feature1': 'Wireframing & Prototipado',
      'service-uiux-feature2': 'InvestigaciÃ³n de Usuario',
      'service-uiux-feature3': 'Sistemas de DiseÃ±o',
      'get-quote': 'Obtener CotizaciÃ³n â†’',
      'skills-title': 'Habilidades',
      'projects-title': 'Proyectos',
      'filter-all': 'Todos',
      'filter-web': 'Web',
      'filter-mobile': 'MÃ³vil',
      'filter-ui': 'UI',
      'filter-tools': 'Herramientas',
      'contact-title': 'ContÃ¡ctame',
      'email-label': 'Correo',
      'phone-label': 'TelÃ©fono',
      'location-label': 'UbicaciÃ³n',
      'name-label': 'Tu Nombre',
      'email-input-label': 'Tu Correo',
      'subject-label': 'Asunto',
      'message-label': 'Mensaje',
      'send-message': 'Enviar Mensaje',
      'blog-title': 'Ãšltimos ArtÃ­culos',
      'read-more': 'Leer MÃ¡s â†’',
      'newsletter-title': 'Mantente Actualizado',
      'newsletter-subtitle': 'ObtÃ©n las Ãºltimas actualizaciones sobre mis proyectos y artÃ­culos entregados en tu bandeja de entrada',
      'subscribe': 'Suscribirse',
      'privacy-notice': 'Respeto tu privacidad. Cancela en cualquier momento. Sin spam, nunca.',
      'success-message': 'Â¡Suscrito exitosamente! Revisa tu correo para confirmaciÃ³n.',
      'resume-title': 'Descargar Mi CV',
      'resume-subtitle': 'ObtÃ©n una descripciÃ³n detallada de mi experiencia y habilidades',
      'view-resume': 'Ver CurrÃ­culum',
      'privacy': 'PolÃ­tica de Privacidad',
      'terms': 'TÃ©rminos de Servicio'
    },
    fr: {
      'themes': 'ThÃ¨mes',
      'light': 'Clair',
      'dark': 'Sombre',
      'ocean': 'OcÃ©an',
      'forest': 'ForÃªt',
      'sunset': 'Coucher',
      'galaxy': 'Galaxie',
      'hero-title': 'Salut, je suis Brian ðŸ‘‹',
      'hero-subtitle': 'DÃ©veloppeur Junior | PassionnÃ© de JavaScript | RÃ©solveur de ProblÃ¨mes',
      'view-projects': 'Voir Projets',
      'contact-me': 'Contactez-moi',
      'about-title': 'Ã€ Propos',
      'about-text': 'Je suis un Ã©tudiant passionnÃ© en ingÃ©nierie logicielle axÃ© sur la crÃ©ation d\'applications web propres et responsives. J\'aime rÃ©soudre des problÃ¨mes avec du code, contribuer Ã  l\'open source et apprendre continuellement des frameworks modernes. J\'explore actuellement React et le dÃ©veloppement full-stack pour crÃ©er des expÃ©riences numÃ©riques percutantes.',
      'projects-label': 'Projets',
      'technologies-label': 'Technologies',
      'commits-label': 'Commits',
      'services-title': 'Services que j\'offre',
      'service-frontend': 'DÃ©veloppement Front-End',
      'service-frontend-desc': 'CrÃ©ation d\'applications web responsives et interactives utilisant React, Vue.js et frameworks JavaScript modernes.',
      'service-frontend-feature1': 'DÃ©veloppement React/Vue.js',
      'service-frontend-feature2': 'Design Responsif',
      'service-frontend-feature3': 'Optimisation des Performances',
      'service-backend': 'DÃ©veloppement Back-End',
      'service-backend-desc': 'Construction d\'applications robustes cÃ´tÃ© serveur avec Node.js, Express et intÃ©gration de bases de donnÃ©es.',
      'service-backend-feature1': 'APIs Node.js/Express',
      'service-backend-feature2': 'Conception de Base de DonnÃ©es',
      'service-backend-feature3': 'SystÃ¨mes d\'Authentification',
      'service-uiux': 'Design UI/UX',
      'service-uiux-desc': 'Conception d\'interfaces magnifiques et centrÃ©es sur l\'utilisateur qui fournissent des expÃ©riences utilisateur exceptionnelles.',
      'service-uiux-feature1': 'Wireframing & Prototypage',
      'service-uiux-feature2': 'Recherche Utilisateur',
      'service-uiux-feature3': 'SystÃ¨mes de Design',
      'get-quote': 'Obtenir un Devis â†’',
      'skills-title': 'CompÃ©tences',
      'projects-title': 'Projets',
      'filter-all': 'Tous',
      'filter-web': 'Web',
      'filter-mobile': 'Mobile',
      'filter-ui': 'UI',
      'filter-tools': 'Outils',
      'contact-title': 'Contactez-moi',
      'email-label': 'Email',
      'phone-label': 'TÃ©lÃ©phone',
      'location-label': 'Localisation',
      'name-label': 'Votre Nom',
      'email-input-label': 'Votre Email',
      'subject-label': 'Sujet',
      'message-label': 'Message',
      'send-message': 'Envoyer Message',
      'blog-title': 'Derniers Articles',
      'read-more': 'Lire Plus â†’',
      'newsletter-title': 'Restez InformÃ©',
      'newsletter-subtitle': 'Obtenez les derniÃ¨res mises Ã  jour sur mes projets et articles livrÃ©s dans votre boÃ®te de rÃ©ception',
      'subscribe': 'S\'abonner',
      'privacy-notice': 'Je respecte votre vie privÃ©e. DÃ©sabonnez Ã  tout moment. Pas de spam, jamais.',
      'success-message': 'AbonnÃ© avec succÃ¨s! VÃ©rifiez votre email pour confirmation.',
      'resume-title': 'TÃ©lÃ©charger Mon CV',
      'resume-subtitle': 'Obtenez une vue d\'ensemble dÃ©taillÃ©e de mon expÃ©rience et compÃ©tences',
      'view-resume': 'Voir CV',
      'privacy': 'Politique de ConfidentialitÃ©',
      'terms': 'Conditions d\'Utilisation'
    },
    de: {
      'themes': 'Themen',
      'light': 'Hell',
      'dark': 'Dunkel',
      'ocean': 'Ozean',
      'forest': 'Wald',
      'sunset': 'Sonnenuntergang',
      'galaxy': 'Galaxie',
      'hero-title': 'Hallo, ich bin Brian ðŸ‘‹',
      'hero-subtitle': 'Junior Entwickler | JavaScript Enthusiast | ProblemlÃ¶ser',
      'view-projects': 'Projekte Ansehen',
      'contact-me': 'Kontaktiere Mich',
      'about-title': 'Ãœber Mich',
      'about-text': 'Ich bin ein leidenschaftlicher Software-Engineering-Student, der sich auf den Bau sauberer, responsiver Webanwendungen konzentriert. Ich liebe es, Probleme mit Code zu lÃ¶sen, zu Open Source beizutragen und kontinuierlich moderne Frameworks zu lernen. Derzeit erkunde ich React und Full-Stack-Entwicklung, um wirkungsvolle digitale Erlebnisse zu schaffen.',
      'projects-label': 'Projekte',
      'technologies-label': 'Technologien',
      'commits-label': 'Commits',
      'services-title': 'Services, die ich anbiete',
      'service-frontend': 'Front-End Entwicklung',
      'service-frontend-desc': 'Erstellung responsiver, interaktiver Webanwendungen mit React, Vue.js und modernen JavaScript-Frameworks.',
      'service-frontend-feature1': 'React/Vue.js Entwicklung',
      'service-frontend-feature2': 'Responsives Design',
      'service-frontend-feature3': 'Performance Optimierung',
      'service-backend': 'Back-End Entwicklung',
      'service-backend-desc': 'Erstellung robuster Server-seit Anwendungen mit Node.js, Express und Datenbank-Integration.',
      'service-backend-feature1': 'Node.js/Express APIs',
      'service-backend-feature2': 'Datenbank-Design',
      'service-backend-feature3': 'Authentifizierungssysteme',
      'service-uiux': 'UI/UX Design',
      'service-uiux-desc': 'Gestaltung schÃ¶ner, benutzerzentrierter Interfaces, die herausragende Benutzererlebnisse bieten.',
      'service-uiux-feature1': 'Wireframing & Prototyping',
      'service-uiux-feature2': 'Benutzerforschung',
      'service-uiux-feature3': 'Design-Systeme',
      'get-quote': 'Angebot Anfordern â†’',
      'skills-title': 'FÃ¤higkeiten',
      'projects-title': 'Projekte',
      'filter-all': 'Alle',
      'filter-web': 'Web',
      'filter-mobile': 'Mobile',
      'filter-ui': 'UI',
      'filter-tools': 'Werkzeuge',
      'contact-title': 'Kontaktiere Mich',
      'email-label': 'Email',
      'phone-label': 'Telefon',
      'location-label': 'Standort',
      'name-label': 'Ihr Name',
      'email-input-label': 'Ihre Email',
      'subject-label': 'Betreff',
      'message-label': 'Nachricht',
      'send-message': 'Nachricht Senden',
      'blog-title': 'Neueste Artikel',
      'read-more': 'Mehr Lesen â†’',
      'newsletter-title': 'Bleib auf dem Laufenden',
      'newsletter-subtitle': 'Erhalten Sie die neuesten Updates zu meinen Projekten und Artikeln direkt in Ihrem Posteingang',
      'subscribe': 'Abonnieren',
      'privacy-notice': 'Ich respektiere Ihre PrivatsphÃ¤re. Jederzeit abbestellbar. Kein Spam, niemals.',
      'success-message': 'Erfolgreich abonniert! ÃœberprÃ¼fen Sie Ihre E-Mail zur BestÃ¤tigung.',
      'resume-title': 'Lebenslauf Herunterladen',
      'resume-subtitle': 'Erhalten Sie eine detaillierte Ãœbersicht meiner Erfahrung und FÃ¤higkeiten',
      'view-resume': 'Lebenslauf Ansehen',
      'privacy': 'DatenschutzerklÃ¤rung',
      'terms': 'Nutzungsbedingungen'
    },
    zh: {
      'themes': 'ä¸»é¢˜',
      'light': 'æµ…è‰²',
      'dark': 'æ·±è‰²',
      'ocean': 'æµ·æ´‹',
      'forest': 'æ£®æž—',
      'sunset': 'æ—¥è½',
      'galaxy': 'é“¶æ²³',
      'hero-title': 'ä½ å¥½ï¼Œæˆ‘æ˜¯Brian ðŸ‘‹',
      'hero-subtitle': 'åˆçº§å¼€å‘è€… | Reactçˆ±å¥½è€… | é—®é¢˜è§£å†³è€…',
      'view-projects': 'æŸ¥çœ‹é¡¹ç›®',
      'contact-me': 'è”ç³»æˆ‘',
      'about-title': 'å…³äºŽæˆ‘',
      'about-text': 'æˆ‘æ˜¯ä¸€åå……æ»¡çƒ­æƒ…çš„è½¯ä»¶å·¥ç¨‹ä¸“ä¸šå­¦ç”Ÿï¼Œä¸“æ³¨äºŽæž„å»ºå¹²å‡€ã€å“åº”å¼çš„Webåº”ç”¨ç¨‹åºã€‚æˆ‘å–œæ¬¢ç”¨ä»£ç è§£å†³é—®é¢˜ï¼Œä¸ºå¼€æºåšè´¡çŒ®ï¼Œå¹¶ä¸æ–­å­¦ä¹ çŽ°ä»£æ¡†æž¶ã€‚ç›®å‰æ­£åœ¨æŽ¢ç´¢Reactå’Œå…¨æ ˆå¼€å‘ï¼Œä»¥åˆ›é€ æœ‰å½±å“åŠ›çš„æ•°å­—ä½“éªŒã€‚',
      'projects-label': 'é¡¹ç›®',
      'technologies-label': 'æŠ€æœ¯',
      'commits-label': 'æäº¤',
      'services-title': 'æˆ‘æä¾›çš„æœåŠ¡',
      'service-frontend': 'å‰ç«¯å¼€å‘',
      'service-frontend-desc': 'ä½¿ç”¨Reactã€Vue.jså’ŒçŽ°ä»£JavaScriptæ¡†æž¶åˆ›å»ºå“åº”å¼ã€äº¤äº’å¼Webåº”ç”¨ç¨‹åºã€‚',
      'service-frontend-feature1': 'React/Vue.jså¼€å‘',
      'service-frontend-feature2': 'å“åº”å¼è®¾è®¡',
      'service-frontend-feature3': 'æ€§èƒ½ä¼˜åŒ–',
      'service-backend': 'åŽç«¯å¼€å‘',
      'service-backend-desc': 'ä½¿ç”¨Node.jsã€Expresså’Œæ•°æ®åº“é›†æˆæž„å»ºå¼ºå¤§çš„æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºã€‚',
      'service-backend-feature1': 'Node.js/Express API',
      'service-backend-feature2': 'æ•°æ®åº“è®¾è®¡',
      'service-backend-feature3': 'èº«ä»½éªŒè¯ç³»ç»Ÿ',
      'service-uiux': 'UI/UXè®¾è®¡',
      'service-uiux-desc': 'è®¾è®¡ç¾Žè§‚ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ç•Œé¢ï¼Œæä¾›å“è¶Šçš„ç”¨æˆ·ä½“éªŒã€‚',
      'service-uiux-feature1': 'çº¿æ¡†å›¾å’ŒåŽŸåž‹',
      'service-uiux-feature2': 'ç”¨æˆ·ç ”ç©¶',
      'service-uiux-feature3': 'è®¾è®¡ç³»ç»Ÿ',
      'get-quote': 'èŽ·å–æŠ¥ä»· â†’',
      'skills-title': 'æŠ€èƒ½',
      'projects-title': 'é¡¹ç›®',
      'filter-all': 'å…¨éƒ¨',
      'filter-web': 'ç½‘é¡µ',
      'filter-mobile': 'ç§»åŠ¨',
      'filter-ui': 'ç•Œé¢',
      'filter-tools': 'å·¥å…·',
      'contact-title': 'è”ç³»æˆ‘',
      'email-label': 'é‚®ç®±',
      'phone-label': 'ç”µè¯',
      'location-label': 'ä½ç½®',
      'name-label': 'å§“å',
      'email-input-label': 'é‚®ç®±',
      'subject-label': 'ä¸»é¢˜',
      'message-label': 'æ¶ˆæ¯',
      'send-message': 'å‘é€æ¶ˆæ¯',
      'blog-title': 'æœ€æ–°æ–‡ç« ',
      'read-more': 'é˜…è¯»æ›´å¤š â†’',
      'newsletter-title': 'ä¿æŒæ›´æ–°',
      'newsletter-subtitle': 'èŽ·å–æˆ‘çš„é¡¹ç›®å’Œæ–‡ç« çš„æœ€æ–°æ›´æ–°ï¼Œç›´æŽ¥å‘é€åˆ°æ‚¨çš„æ”¶ä»¶ç®±',
      'subscribe': 'è®¢é˜…',
      'privacy-notice': 'æˆ‘å°Šé‡æ‚¨çš„éšç§ã€‚éšæ—¶å¯ä»¥å–æ¶ˆè®¢é˜…ã€‚ç»ä¸å‘é€åžƒåœ¾é‚®ä»¶ã€‚',
      'success-message': 'è®¢é˜…æˆåŠŸï¼è¯·æŸ¥çœ‹æ‚¨çš„ç”µå­é‚®ä»¶è¿›è¡Œç¡®è®¤ã€‚',
      'resume-title': 'ä¸‹è½½æˆ‘çš„ç®€åŽ†',
      'resume-subtitle': 'èŽ·å–æˆ‘çš„ç»éªŒå’ŒæŠ€èƒ½çš„è¯¦ç»†æ¦‚è¿°',
      'view-resume': 'æŸ¥çœ‹ç®€åŽ†',
      'privacy': 'éšç§æ”¿ç­–',
      'terms': 'æœåŠ¡æ¡æ¬¾'
    }
  };
  
  /* ===========================
     PAGE TRANSITIONS
     =========================== */
  const pageTransitionOverlay = document.querySelector('.page-transition-overlay');
  
  function showPageTransition() {
    pageTransitionOverlay.classList.add('active');
    setTimeout(() => {
      pageTransitionOverlay.classList.remove('active');
    }, 1500);
  }
  
  // Show transition on page load
  window.addEventListener('load', () => {
    setTimeout(() => {
      showPageTransition();
    }, 500);
  });
  
  // Handle navigation with transitions
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      if (link.hash) {
        e.preventDefault();
        const targetSection = document.querySelector(link.hash);
        if (targetSection) {
          showPageTransition();
          setTimeout(() => {
            targetSection.scrollIntoView({ behavior: 'smooth' });
          }, 800);
        }
      }
    });
  });
  
  /* ===========================
     FONT SIZE ADJUSTER
     =========================== */
  const fontButtons = document.querySelectorAll('.font-btn');
  const fontSizeLabel = document.querySelector('.font-size-label');
  let currentFontSize = 1;
  
  function updateFontSize(multiplier) {
    currentFontSize = Math.max(0.8, Math.min(1.4, currentFontSize + multiplier));
    document.documentElement.style.setProperty('--font-size-multiplier', currentFontSize);
    
    // Update label size
    const labelSize = 14 + (currentFontSize - 1) * 4;
    fontSizeLabel.style.fontSize = `${labelSize}px`;
    
    // Save to localStorage
    localStorage.setItem('fontSize', currentFontSize);
  }
  
  fontButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const size = btn.dataset.size;
      if (size === 'increase') {
        updateFontSize(0.1);
      } else {
        updateFontSize(-0.1);
      }
    });
  });
  
  // Load saved font size
  const savedFontSize = localStorage.getItem('fontSize');
  if (savedFontSize) {
    currentFontSize = parseFloat(savedFontSize);
    document.documentElement.style.setProperty('--font-size-multiplier', currentFontSize);
    const labelSize = 14 + (currentFontSize - 1) * 4;
    fontSizeLabel.style.fontSize = `${labelSize}px`;
  }
  
  /* ===========================
     LANGUAGE SWITCHER
     =========================== */
  const langOptions = document.querySelectorAll('.lang-option');
  const langCurrent = document.querySelector('.lang-current');
  const langCodes = {
    'en': 'EN',
    'es': 'ES',
    'fr': 'FR',
    'de': 'DE',
    'zh': 'ZH'
  };
  
  function updateLanguage(lang) {
    // Update active state
    langOptions.forEach(option => {
      option.classList.remove('active');
      if (option.dataset.lang === lang) {
        option.classList.add('active');
      }
    });
    
    // Update current language display
    langCurrent.textContent = langCodes[lang];
    
    // Update all translatable elements
    document.querySelectorAll('[data-translate]').forEach(element => {
      const key = element.getAttribute('data-translate');
      if (translations[lang] && translations[lang][key]) {
        element.textContent = translations[lang][key];
      }
    });
    
    // Save to localStorage
    localStorage.setItem('language', lang);
  }
  
  langOptions.forEach(option => {
    option.addEventListener('click', () => {
      updateLanguage(option.dataset.lang);
    });
  });
  
  // Load saved language
  const savedLanguage = localStorage.getItem('language') || 'en';
  updateLanguage(savedLanguage);
  
  /* ===========================
     THEME MANAGEMENT
     =========================== */
  const themeOptions = document.querySelectorAll('.theme-option');
  const themeToggleBtn = document.querySelector('.theme-toggle-btn');
  
  function applyTheme(themeName) {
    // Remove all theme classes
    document.body.classList.remove('light', 'dark', 'ocean', 'forest', 'sunset', 'galaxy');
    
    // Add the new theme class
    if (themeName !== 'light') {
      document.body.classList.add(themeName);
    }
    
    // Update active state
    themeOptions.forEach(option => {
      option.classList.remove('active');
      if (option.dataset.theme === themeName) {
        option.classList.add('active');
      }
    });
    
    // Save to localStorage
    localStorage.setItem('theme', themeName);
    
    // Update button icon
    updateThemeButton(themeName);
    
    // Fix hero text visibility
    setTimeout(fixHeroTextVisibility, 100);
  }
  
  function updateThemeButton(themeName) {
    const icons = {
      light: 'fa-sun',
      dark: 'fa-moon',
      ocean: 'fa-water',
      forest: 'fa-tree',
      sunset: 'fa-cloud-sun',
      galaxy: 'fa-star'
    };
    
    const icon = themeToggleBtn.querySelector('i');
    icon.className = `fas ${icons[themeName]}`;
  }
  
  function loadThemeFromStorage() {
    const saved = localStorage.getItem('theme') || 'light';
    applyTheme(saved);
  }
  
  // Theme option click handlers
  themeOptions.forEach(option => {
    option.addEventListener('click', () => {
      applyTheme(option.dataset.theme);
    });
  });
  
  // Initialize theme on load
  loadThemeFromStorage();
  
  /* ===========================
     HERO TEXT VISIBILITY FIX
     =========================== */
  function fixHeroTextVisibility() {
    const heroText = document.querySelector('.hero-text');
    const heroTitle = document.querySelector('.hero-text h1');
    const typedText = document.getElementById('typed');
    const btnPrimary = document.querySelector('.btn-primary');
    const btnOutline = document.querySelector('.btn-outline');
    
    const currentTheme = document.body.className;
    
    const themeColors = {
      'ocean': {
        text: '#ffffff',
        btnBg: '#4dd0e1',
        btnText: '#004d40',
        outlineBorder: '#4dd0e1',
        outlineText: '#4dd0e1'
      },
      'forest': {
        text: '#ffffff',
        btnBg: '#66bb6a',
        btnText: '#1b5e20',
        outlineBorder: '#66bb6a',
        outlineText: '#66bb6a'
      },
      'sunset': {
        text: '#ffffff',
        btnBg: '#ffb74d',
        btnText: '#e65100',
        outlineBorder: '#ffb74d',
        outlineText: '#ffb74d'
      },
      'galaxy': {
        text: '#ffffff',
        btnBg: '#ba68c8',
        btnText: '#4a148c',
        outlineBorder: '#ba68c8',
        outlineText: '#ba68c8'
      },
      'dark': {
        text: '#ffffff',
        btnBg: '#ffffff',
        btnText: '#007bff',
        outlineBorder: '#ffffff',
        outlineText: '#ffffff'
      },
      'light': {
        text: '#212529',
        btnBg: '#007bff',
        btnText: '#ffffff',
        outlineBorder: '#007bff',
        outlineText: '#007bff'
      }
    };
    
    const colors = themeColors[currentTheme] || themeColors['light'];
    
    // Apply colors with inline styles for maximum specificity
    if (heroText) heroText.style.color = colors.text;
    if (heroTitle) heroTitle.style.color = colors.text;
    if (typedText) typedText.style.color = colors.text;
    
    if (btnPrimary) {
      btnPrimary.style.backgroundColor = colors.btnBg;
      btnPrimary.style.color = colors.btnText;
    }
    
    if (btnOutline) {
      btnOutline.style.backgroundColor = 'transparent';
      btnOutline.style.color = colors.outlineText;
      btnOutline.style.border = `2px solid ${colors.outlineBorder}`;
    }
  }
  
  /* ===========================
     CUSTOM CURSOR
     =========================== */
  const cursor = document.querySelector('.cursor');
  const cursorFollower = document.querySelector('.cursor-follower');
  
  document.addEventListener('mousemove', (e) => {
    cursor.style.left = e.clientX + 'px';
    cursor.style.top = e.clientY + 'px';
    
    setTimeout(() => {
      cursorFollower.style.left = e.clientX + 'px';
      cursorFollower.style.top = e.clientY + 'px';
    }, 100);
  });
  
  document.addEventListener('mousedown', () => {
    cursor.style.transform = 'translate(-50%, -50%) scale(0.8)';
    cursorFollower.style.transform = 'translate(-50%, -50%) scale(0.8)';
  });
  
  document.addEventListener('mouseup', () => {
    cursor.style.transform = 'translate(-50%, -50%) scale(1)';
    cursorFollower.style.transform = 'translate(-50%, -50%) scale(1)';
  });
  
  /* ===========================
     MOBILE MENU
     =========================== */
  const menuToggle = document.querySelector('.menu-toggle');
  const navLinks = document.querySelector('.nav-links');
  
  menuToggle.addEventListener('click', () => {
    navLinks.classList.toggle('active');
    menuToggle.classList.toggle('active');
  });
  
  /* ===========================
     TYPED HERO TEXT
     =========================== */
  const roles = [
    "Software Engineering student.",
    "Web developer.",
    "Problem solver.",
    "Open-source contributor."
  ];
  const typedEl = document.getElementById("typed");
  let ti = 0, ci = 0, deleting = false;
  
  function typeLoop() {
    if (!typedEl) return;
    const currentLang = localStorage.getItem('language') || 'en';
    const currentRoles = translations[currentLang]['hero-subtitle'].split(' | ');
    const current = currentRoles[ti] || roles[ti];
    
    typedEl.textContent = current.slice(0, ci);
    if (!deleting) {
      ci++;
      if (ci > current.length) {
        deleting = true;
        setTimeout(typeLoop, 1200);
        return;
      }
    } else {
      ci--;
      if (ci < 0) {
        deleting = false;
        ti = (ti + 1) % currentRoles.length;
        setTimeout(typeLoop, 300);
        return;
      }
    }
    setTimeout(typeLoop, deleting ? 40 : 80);
  }
  typeLoop();
  
  /* ===========================
     PARTICLES ANIMATION
     =========================== */
  function createParticles() {
    const particlesContainer = document.querySelector('.particles');
    if (!particlesContainer) return;
    
    const particlesCount = 50;
    
    for (let i = 0; i < particlesCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      
      const size = Math.random() * 5 + 1;
      const posX = Math.random() * 100;
      const posY = Math.random() * 100;
      const delay = Math.random() * 20;
      const duration = Math.random() * 20 + 10;
      
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${posX}%`;
      particle.style.top = `${posY}%`;
      particle.style.animationDelay = `${delay}s`;
      particle.style.animationDuration = `${duration}s`;
      
      particlesContainer.appendChild(particle);
    }
  }
  
  createParticles();
  
  /* ===========================
     ENHANCED SCROLL ANIMATIONS
     =========================== */
  const observerOptions = {
    threshold: 0.15, // Trigger earlier for better swipe effect
    rootMargin: '0px 0px -30px 0px' // Adjusted for earlier triggering
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        
        // Enhanced stagger animation for multiple elements
        const staggerElements = entry.target.querySelectorAll('.skill-item, .practice-item, .tech-group, .achievement, .service-card, .project-item, .building-card, .featured-card');
        staggerElements.forEach((el, index) => {
          setTimeout(() => {
            el.classList.add('visible');
          }, index * 150); // Increased delay for more dramatic swipe effect
        });
        
        // Special handling for about section
        if (entry.target.querySelector('.about-text, .about-image')) {
          setTimeout(() => {
            entry.target.querySelector('.about-text')?.classList.add('visible');
          }, 200);
          
          setTimeout(() => {
            entry.target.querySelector('.about-image')?.classList.add('visible');
          }, 400);
        }
      }
    });
  }, observerOptions);
  
  // Observe all sections with enhanced timing
  document.querySelectorAll('.page-section').forEach((section, index) => {
    // Add initial delay for each section
    setTimeout(() => {
      observer.observe(section);
    }, index * 100);
  });
  
  // Enhanced smooth scroll behavior with offset
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        const offsetTop = target.offsetTop - 100; // Increased offset for better spacing
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
        
        // Add active state to navigation
        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('active');
        });
        this.classList.add('active');
      }
    });
  });
  
  // Enhanced parallax effect with smoother performance
  let parallaxTicking = false;
  
  function updateParallax() {
    const scrolled = window.pageYOffset;
    const parallaxElements = document.querySelectorAll('.hero-bg, .floating-shapes .shape');
    
    parallaxElements.forEach((element, index) => {
      const speed = 0.3 + (index * 0.05); // Reduced speed for subtler effect
      const yPos = -(scrolled * speed);
      element.style.transform = `translate3d(0, ${yPos}px, 0)`;
    });
    
    parallaxTicking = false;
  }
  
  function requestParallaxTick() {
    if (!parallaxTicking) {
      window.requestAnimationFrame(updateParallax);
      parallaxTicking = true;
    }
  }
  
  window.addEventListener('scroll', requestParallaxTick);
  
  // Enhanced reveal animations for specific elements
  const revealElements = document.querySelectorAll('.resume-achievements .achievement, .featured-card, .building-card');
  revealElements.forEach((el, index) => {
    setTimeout(() => {
      observer.observe(el);
    }, index * 50);
  });

  /* ===========================
     SCROLL PROGRESS INDICATOR
     =========================== */
  const scrollProgressBar = document.querySelector('.scroll-progress-bar');
  
  window.addEventListener('scroll', () => {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrollProgress = (scrollTop / scrollHeight) * 100;
    
    if (scrollProgressBar) {
      scrollProgressBar.style.width = scrollProgress + '%';
    }
    
    // Hide/show scroll progress based on scroll position
    const scrollProgressContainer = document.querySelector('.scroll-progress');
    if (scrollProgressContainer) {
      if (scrollTop > 100) {
        scrollProgressContainer.style.opacity = '1';
      } else {
        scrollProgressContainer.style.opacity = '0';
      }
    }
  });

  /* ===========================
     IMAGE LOADING ANIMATIONS
     =========================== */
  const images = document.querySelectorAll('img');
  images.forEach(img => {
    if (img.complete) {
      img.classList.add('loaded');
    } else {
      img.addEventListener('load', () => {
        img.classList.add('loaded');
      });
    }
  });

  /* ===========================
     ENHANCED PARALLAX EFFECTS
     =========================== */
  let ticking = false;
  
  function updateParallax() {
    const scrolled = window.pageYOffset;
    const parallaxElements = document.querySelectorAll('.floating-shapes .shape');
    
    parallaxElements.forEach((element, index) => {
      const speed = 0.5 + (index * 0.1);
      const yPos = -(scrolled * speed);
      element.style.transform = `translate3d(0, ${yPos}px, 0)`;
    });
    
    ticking = false;
  }
  
  function requestTick() {
    if (!ticking) {
      window.requestAnimationFrame(updateParallax);
      ticking = true;
    }
  }
  
  window.addEventListener('scroll', requestTick);

  /* ===========================
     MOUSE TILT EFFECT FOR CARDS
     =========================== */
  const cards = document.querySelectorAll('.service-card, .project-item, .featured-card, .building-card');
  
  cards.forEach(card => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      const rotateX = (y - centerY) / 10;
      const rotateY = (centerX - x) / 10;
      
      card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
    });
    
    card.addEventListener('mouseleave', () => {
      card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
    });
  });
  
  /* ===========================
     COUNTER ANIMATION
     =========================== */
  const counters = document.querySelectorAll('.stat-number');
  const speed = 200;
  
  const countUp = () => {
    counters.forEach(counter => {
      const target = +counter.getAttribute('data-target');
      const count = +counter.innerText;
      const increment = target / speed;
      
      if (count < target) {
        counter.innerText = Math.ceil(count + increment);
        setTimeout(countUp, 10);
      } else {
        counter.innerText = target;
      }
    });
  };
  
  // Trigger counter animation when about section is visible
  const aboutSection = document.getElementById('about');
  const aboutObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        countUp();
        aboutObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });
  
  aboutObserver.observe(aboutSection);
  
  /* ===========================
     SKILL BARS
     =========================== */
  const skillBars = document.querySelectorAll(".bar");
  if ("IntersectionObserver" in window) {
    const skillObserver = new IntersectionObserver((entries, o) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const width = entry.target.dataset.width;
          entry.target.style.width = width + "%";
          o.unobserve(entry.target);
        }
      });
    }, { threshold: 0.4 });
    skillBars.forEach(b => skillObserver.observe(b));
  } else {
    skillBars.forEach(b => b.style.width = b.dataset.width + "%");
  }
  
  /* ===========================
     PROJECT FILTER
     =========================== */
  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelector(".filter-btn.active")?.classList.remove("active");
      btn.classList.add("active");
      const f = btn.dataset.filter;
      document.querySelectorAll(".project-card-3d").forEach(card => {
        if (f === "all") {
          card.style.display = "";
          return;
        }
        const tags = (card.dataset.tags || "").split(" ").map(t => t.trim());
        card.style.display = tags.includes(f) ? "" : "none";
      });
    });
  });
  
  /* ===========================
     CONTACT FORM (EmailJS)
     =========================== */
  (function () {
    if (window.emailjs) {
      try {
        emailjs.init("oD8O16m34hGHpi-1S");
      } catch (e) {
        console.warn("EmailJS init failed", e);
      }
    }
  })();
  
  const contactForm = document.getElementById("contact-form");
  if (contactForm) {
    contactForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const btn = contactForm.querySelector("button[type='submit']");
      btn.disabled = true;
      btn.textContent = "Sendingâ€¦";
  
      if (window.emailjs) {
        emailjs.sendForm("service_8g01mr", "template_vx207z1", "#contact-form")
          .then(() => {
            showNotification("âœ… Message sent! I'll get back to you soon.", 'success');
            contactForm.reset();
            btn.disabled = false;
            btn.textContent = translations[localStorage.getItem('language') || 'en']['send-message'];
          }, (err) => {
            console.error("EmailJS error:", err);
            showNotification("âŒ Failed to send. Please try again or email me directly.", 'error');
            btn.disabled = false;
            btn.textContent = translations[localStorage.getItem('language') || 'en']['send-message'];
          });
      } else {
        showNotification("âš ï¸ EmailJS not loaded. Contact form disabled.", 'warning');
        contactForm.reset();
        btn.disabled = false;
        btn.textContent = translations[localStorage.getItem('language') || 'en']['send-message'];
      }
    });
  }
  
  /* ===========================
     NEWSLETTER FORM
     =========================== */
  const newsletterForm = document.getElementById('newsletter-form');
  const newsletterSuccess = document.getElementById('newsletter-success');
  
  if (newsletterForm) {
    newsletterForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('newsletter-email').value;
      
      // Simulate API call
      setTimeout(() => {
        newsletterSuccess.classList.add('show');
        newsletterForm.reset();
        
        setTimeout(() => {
          newsletterSuccess.classList.remove('show');
        }, 3000);
      }, 1000);
    });
  }
  
  /* ===========================
     GITHUB: Recent Repos
     =========================== */
  (function loadRecentRepos() {
    const username = "brianmuigai2-stack";
    fetch(`https://api.github.com/users/${username}/repos?per_page=6&sort=updated`)
      .then(r => r.ok ? r.json() : Promise.reject(r.status))
      .then(repos => {
        const recentRepos = repos.slice(0, 4);
        const parent = document.getElementById("recent-repos");
        if (!parent || recentRepos.length === 0) return;
  
        recentRepos.forEach(repo => {
          const a = document.createElement("a");
          a.href = repo.html_url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.className = "repo";
          a.innerHTML = `<strong>${repo.name}</strong><span>â˜… ${repo.stargazers_count}</span>`;
          parent.appendChild(a);
        });
      })
      .catch(err => {
        console.warn("GitHub repos failed:", err);
      });
  })();
  
  /* ===========================
     LAZY LOADING IMAGES
     =========================== */
  const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        img.src = img.dataset.src;
        img.classList.remove('lazy');
        img.classList.add('loaded');
        observer.unobserve(img);
      }
    });
  });
  
  document.querySelectorAll('img[data-src]').forEach(img => {
    imageObserver.observe(img);
  });
  
  /* ===========================
     Smooth Scroll
     =========================== */
  document.querySelectorAll(".hero-buttons a, .back-to-top a").forEach(link => {
    link.addEventListener("click", (e) => {
      if (link.hash) {
        e.preventDefault();
        document.querySelector(link.hash)?.scrollIntoView({ behavior: "smooth" });
      }
    });
  });
  
  /* ===========================
     SCROLL TO TOP BUTTON
     =========================== */
  const backToTopButton = document.querySelector('.back-to-top a');
  
  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      backToTopButton.style.opacity = '1';
      backToTopButton.style.visibility = 'visible';
    } else {
      backToTopButton.style.opacity = '0';
      backToTopButton.style.visibility = 'hidden';
    }
  });
  
  /* ===========================
     SEO CANONICAL URL FIX
     =========================== */
  function ensureCanonicalURL() {
    const currentURL = 'https://brianmuigai2-stack.github.io/my-first-website/';
    let canonical = document.querySelector('link[rel="canonical"]');
    
    if (!canonical) {
      canonical = document.createElement('link');
      canonical.rel = 'canonical';
      document.head.appendChild(canonical);
    }
    
    canonical.href = currentURL;
    
    // Also update Open Graph URL
    const ogURL = document.querySelector('meta[property="og:url"]');
    if (ogURL) {
      ogURL.content = currentURL;
    }
    
    // Update Twitter URL
    const twitterURL = document.querySelector('meta[property="twitter:url"]');
    if (twitterURL) {
      twitterURL.content = currentURL;
    }
  }
  
  /* ===========================
     GITHUB INTEGRATION
     =========================== */
  const githubUsername = 'brianmuigai2-stack';
  
  async function fetchGitHubData() {
    try {
      // Fetch user data
      const userResponse = await fetch(`https://api.github.com/users/${githubUsername}`);
      const userData = await userResponse.json();
      
      // Fetch repositories
      const reposResponse = await fetch(`https://api.github.com/users/${githubUsername}/repos?sort=updated&per_page=10`);
      const reposData = await reposResponse.json();
      
      // Update stats
      updateGitHubStats(userData, reposData);
      
      // Update projects with real data
      updateProjectsWithGitHubData(reposData);
      
    } catch (error) {
      console.log('GitHub API rate limit reached or error occurred:', error);
    }
  }
  
  function updateGitHubStats(userData, reposData) {
    // Update project count
    const projectCount = document.querySelector('[data-target="15"]');
    if (projectCount && userData.public_repos) {
      projectCount.setAttribute('data-target', userData.public_repos);
    }
    
    // Update commit count (approximate)
    const commitCount = document.querySelector('[data-target="500"]');
    if (commitCount) {
      const totalCommits = reposData.reduce((sum, repo) => sum + (repo.pushed_at ? 1 : 0), 0) * 10;
      commitCount.setAttribute('data-target', Math.min(totalCommits, 2000));
    }
    
    // Update technologies based on languages from repos
    const languages = new Set();
    reposData.forEach(repo => {
      if (repo.language) {
        languages.add(repo.language);
      }
    });
    
    const techCount = document.querySelector('[data-target="8"]');
    if (techCount) {
      techCount.setAttribute('data-target', languages.size);
    }
  }
  
  function updateProjectsWithGitHubData(reposData) {
    // Add real GitHub data to project cards
    const projectCards = document.querySelectorAll('.project-card-3d');
    
    reposData.slice(0, 5).forEach((repo, index) => {
      if (projectCards[index]) {
        const card = projectCards[index];
        
        // Update project links to use real GitHub URLs
        const links = card.querySelectorAll('.project-links a');
        if (links[1]) { // GitHub link
          links[1].href = repo.html_url;
        }
        
        // Add last updated info
        const lastUpdated = new Date(repo.updated_at).toLocaleDateString();
        const projectInfo = card.querySelector('.project-info p');
        if (projectInfo) {
          projectInfo.innerHTML += `<br><small>Last updated: ${lastUpdated}</small>`;
        }
        
        // Add stars count
        if (repo.stargazers_count > 0) {
          const projectInfo = card.querySelector('.project-info');
          const starsBadge = document.createElement('div');
          starsBadge.className = 'github-stars';
          starsBadge.innerHTML = `<i class="fas fa-star"></i> ${repo.stargazers_count}`;
          projectInfo.appendChild(starsBadge);
        }
      }
    });
  }
  
  // Add GitHub stars CSS
  const githubStyle = document.createElement('style');
  githubStyle.textContent = `
    .github-stars {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--accent);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      z-index: 10;
    }
  `;
  document.head.appendChild(githubStyle);

  /* ===========================
     INITIALIZATION
     =========================== */
  document.addEventListener('DOMContentLoaded', () => {
    // Ensure canonical URL is correct
    ensureCanonicalURL();
    
    // Apply hero text fix on load
    fixHeroTextVisibility();
    
    // Update language on load
    const savedLanguage = localStorage.getItem('language') || 'en';
    updateLanguage(savedLanguage);
    
    // Initialize animations
    createParticles();
    
    // Load GitHub repos
    fetchGitHubData();
    
    // Add smooth scrolling behavior
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
    
    // Add scroll animations
    const scrollObserverOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const scrollObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          
          // Animate stat numbers when they come into view
          const statNumbers = entry.target.querySelectorAll('.stat-number');
          statNumbers.forEach(stat => {
            const target = parseInt(stat.getAttribute('data-target'));
            if (!stat.classList.contains('animated')) {
              animateNumber(stat, 0, target, 2000);
              stat.classList.add('animated');
            }
          });
        }
      });
    }, scrollObserverOptions);
    
    // Observe all sections
    document.querySelectorAll('.page-section').forEach(section => {
      scrollObserver.observe(section);
    });
    
    function animateNumber(element, start, end, duration) {
      const startTime = performance.now();
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        const current = Math.floor(start + (end - start) * progress);
        element.textContent = current;
        
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      
      requestAnimationFrame(update);
    }
  });
  
  /* ===========================
     PERFORMANCE MONITORING
     =========================== */
  function monitorPerformance() {
    // Track Core Web Vitals
    if ('PerformanceObserver' in window) {
      const observer = new PerformanceObserver((list) => {
        list.getEntries().forEach((entry) => {
          if (entry.entryType === 'largest-contentful-paint') {
            console.log('LCP:', entry.startTime);
          }
          if (entry.entryType === 'first-input') {
            console.log('FID:', entry.processingStart - entry.startTime);
          }
          if (entry.entryType === 'layout-shift') {
            console.log('CLS:', entry.value);
          }
        });
      });
      
      observer.observe({ entryTypes: ['largest-contentful-paint', 'first-input', 'layout-shift'] });
    }
  }
  
  // Initialize performance monitoring
  monitorPerformance();
  
  /* ===========================
     ANALYTICS
     =========================== */
  function initAnalytics() {
    // Google Analytics 4 (replace with your actual GA4 ID)
    if (typeof gtag !== 'undefined') {
      gtag('config', 'GA_MEASUREMENT_ID');
      
      // Track page views
      gtag('event', 'page_view', {
        page_title: document.title,
        page_location: window.location.href
      });
      
      // Track theme changes
      document.querySelectorAll('.theme-option').forEach(btn => {
        btn.addEventListener('click', () => {
          gtag('event', 'theme_change', {
            theme_name: btn.dataset.theme
          });
        });
      });
      
      // Track language changes
      document.querySelectorAll('.lang-option').forEach(btn => {
        btn.addEventListener('click', () => {
          gtag('event', 'language_change', {
            language: btn.dataset.lang
          });
        });
      });
      
      // Track contact form submissions
      const contactForm = document.getElementById('contact-form');
      if (contactForm) {
        contactForm.addEventListener('submit', () => {
          gtag('event', 'form_submit', {
            event_category: 'engagement',
            event_label: 'contact_form'
          });
        });
      }
      
      // Track newsletter subscriptions
      const newsletterForm = document.getElementById('newsletter-form');
      if (newsletterForm) {
        newsletterForm.addEventListener('submit', () => {
          gtag('event', 'newsletter_subscribe', {
            event_category: 'engagement',
            event_label: 'newsletter_form'
          });
        });
      }
      
      // Track project clicks
      document.querySelectorAll('.project-links a').forEach(link => {
        link.addEventListener('click', () => {
          gtag('event', 'project_click', {
            event_category: 'engagement',
            event_label: link.getAttribute('aria-label') || 'project_link'
          });
        });
      });
    }
  }
  
  // Initialize analytics if available
  if (typeof gtag !== 'undefined') {
    initAnalytics();
  }

  /* ===========================
     CUSTOM NOTIFICATION SYSTEM
     =========================== */
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `custom-notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#ff9800'};
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 10001;
      animation: slideInRight 0.3s ease;
      max-width: 300px;
      font-size: 14px;
    `;
    document.body.appendChild(notification);
    setTimeout(() => {
      notification.style.animation = 'slideOutRight 0.3s ease';
      setTimeout(() => document.body.removeChild(notification), 300);
    }, 3000);
  }

  const notificationStyle = document.createElement('style');
  notificationStyle.textContent = `
    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(400px); opacity: 0; }
    }
  `;
  document.head.appendChild(notificationStyle);
  
  /* ===========================
     MUSIC PLAYER - IMPROVED VERSION
     =========================== */
  document.addEventListener('DOMContentLoaded', function() {
    const musicPlayer = document.getElementById('music-player');
    const musicToggle = document.getElementById('music-toggle');
    const playBtn = document.getElementById('play-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const volumeSlider = document.getElementById('volume-slider');
    const progressBar = document.querySelector('.progress');
    const backgroundMusic = document.getElementById('background-music');
    
    // Check if all elements exist
    if (!musicPlayer || !musicToggle || !playBtn || !backgroundMusic) {
      console.warn('Music player elements not found');
      return;
    }
    
    // Playlist with multiple reliable sources
    const playlist = [
      {
        title: "Ambient Vibes",
        artist: "Portfolio Experience",
        src: "./audio/music.mp3"
      // },
      // {
      //   title: "Creative Flow",
      //   artist: "Background Music",
      //   src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
      // },
      // {
      //   title: "Digital Dreams",
      //   artist: "Ambient Sounds",
      //   src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
       }
    ];
    
    let currentTrackIndex = 0;
    let isPlaying = false;
    let hasInteracted = false;
    
    // Initialize audio element
    backgroundMusic.preload = 'auto';
    backgroundMusic.volume = 0.3;
    
    // Load first track
    loadTrack(0);
    
    // Toggle music player visibility
    musicToggle.addEventListener('click', function() {
      musicPlayer.classList.toggle('active');
      hasInteracted = true;
      localStorage.setItem('musicPlayerInteracted', 'true');
      
      // Try to play music on first interaction
      if (!isPlaying && hasInteracted) {
        attemptPlay();
      }
    });
    
    // Play/Pause functionality
    playBtn.addEventListener('click', function(e) {
      e.stopPropagation(); // Prevent toggling the player
      hasInteracted = true;
      
      if (isPlaying) {
        backgroundMusic.pause();
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        isPlaying = false;
      } else {
        attemptPlay();
      }
    });
    
    // Attempt to play with user interaction
    function attemptPlay() {
      const playPromise = backgroundMusic.play();
      
      if (playPromise !== undefined) {
        playPromise.then(() => {
          // Audio started playing successfully
          isPlaying = true;
          playBtn.innerHTML = '<i class="fas fa-pause"></i>';
          console.log('Music started playing');
        }).catch(error => {
          // Autoplay was prevented
          console.log('Autoplay prevented:', error);
          isPlaying = false;
          playBtn.innerHTML = '<i class="fas fa-play"></i>';
          
          // Show a message to the user
          showMusicHint();
        });
      }
    }
    
    // Show hint to user
    function showMusicHint() {
      const hint = document.createElement('div');
      hint.style.cssText = `
        position: fixed;
        bottom: 100px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 10000;
        animation: fadeInOut 3s ease-in-out;
      `;
      hint.textContent = 'Click the play button to start music';
      document.body.appendChild(hint);
      
      setTimeout(() => {
        document.body.removeChild(hint);
      }, 3000);
    }
    
    // Previous track
    prevBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
      loadTrack(currentTrackIndex);
      if (isPlaying) {
        setTimeout(() => attemptPlay(), 100);
      }
    });
    
    // Next track
    nextBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
      loadTrack(currentTrackIndex);
      if (isPlaying) {
        setTimeout(() => attemptPlay(), 100);
      }
    });
    
    // Volume control
    volumeSlider.addEventListener('input', function(e) {
      e.stopPropagation();
      const volume = this.value / 100;
      backgroundMusic.volume = volume;
      localStorage.setItem('musicVolume', volume);
    });
    
    // Load saved volume
    const savedVolume = localStorage.getItem('musicVolume');
    if (savedVolume) {
      backgroundMusic.volume = parseFloat(savedVolume);
      volumeSlider.value = savedVolume * 100;
    }
    
    // Update progress bar
    backgroundMusic.addEventListener('timeupdate', function() {
      if (backgroundMusic.duration) {
        const progress = (backgroundMusic.currentTime / backgroundMusic.duration) * 100;
        progressBar.style.width = progress + '%';
      }
    });
    
    // Handle track end
    backgroundMusic.addEventListener('ended', function() {
      currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
      loadTrack(currentTrackIndex);
      if (isPlaying) {
        setTimeout(() => attemptPlay(), 100);
      }
    });
    
    // Handle audio errors
    backgroundMusic.addEventListener('error', function(e) {
      console.error('Audio error:', e);
      // Try next track
      currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
      loadTrack(currentTrackIndex);
    });
    
    // Load track function
    function loadTrack(index) {
      const track = playlist[index];
      backgroundMusic.src = track.src;
      document.querySelector('.music-title').textContent = track.title;
      document.querySelector('.music-artist').textContent = track.artist;
      progressBar.style.width = '0%';
      
      // Update play button
      if (isPlaying) {
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
      } else {
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
      }
    }
    
    // Check if user has previously interacted with music player
    const hasInteractedBefore = localStorage.getItem('musicPlayerInteracted');
    if (hasInteractedBefore === 'true') {
      // Auto-open the player if user has interacted before
      setTimeout(() => {
        musicPlayer.classList.add('active');
      }, 2000);
    }
    
    // Add keyboard controls
    document.addEventListener('keydown', function(e) {
      if (e.code === 'Space' && musicPlayer.classList.contains('active')) {
        e.preventDefault();
        playBtn.click();
      }
    });
    
    // Add visual feedback for loading
    backgroundMusic.addEventListener('loadstart', function() {
      playBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    });
    
    backgroundMusic.addEventListener('canplay', function() {
      if (!isPlaying) {
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
      }
    });
  });
  
  // Add CSS animation for hint
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(10px); }
      20% { opacity: 1; transform: translateY(0); }
      80% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-10px); }
    }
  `;
  document.head.appendChild(style);

  /* ===========================
     RESUME MODAL FUNCTIONS
     =========================== */
  function openResumeModal() {
    const modal = document.getElementById('resume-modal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeResumeModal() {
    const modal = document.getElementById('resume-modal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }

  // Close modal when clicking outside
  document.getElementById('resume-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeResumeModal();
    }
  });

  // Close modal with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeResumeModal();
    }
  });

  /* ===========================
     ENHANCED SKILL BARS ANIMATION
     =========================== */
  const enhancedSkillBars = document.querySelectorAll(".skill-progress");
  if ("IntersectionObserver" in window) {
    const enhancedSkillObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const width = entry.target.dataset.width;
          entry.target.style.setProperty('--skill-width', width + '%');
          entry.target.style.width = width + '%';
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    
    enhancedSkillBars.forEach(bar => {
      // Set initial width to 0 for animation
      bar.style.width = '0%';
      enhancedSkillObserver.observe(bar);
    });
  } else {
    // Fallback for browsers without IntersectionObserver
    enhancedSkillBars.forEach(bar => {
      const width = bar.dataset.width;
      bar.style.width = width + '%';
    });
  }
